<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LocalStorage Admin</title>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#121212; color:#fff; }
header { display:flex; justify-content:space-between; align-items:center; padding:16px 24px; background:#000; box-shadow:0 4px 10px rgba(0,0,0,0.5);}
header h1 { margin:0; font-size:1.8rem; }
header button { background:#ff0000; padding:8px 16px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.2s; }
header button:hover { background:#cc0000; transform:scale(1.05); }

.container { max-width:1000px; margin:24px auto; display:flex; flex-direction:column; gap:24px; }
.card { background:#1e1e1e; padding:16px; border-radius:12px; }
h2 { margin-top:0; }

.data-section { margin-top:12px; max-height:400px; overflow-y:auto; border:1px solid #333; padding:12px; border-radius:8px; background:#2a2a2a; }
.data-item { border-bottom:1px solid #444; padding:8px 0; display:flex; justify-content:space-between; align-items:center; }
.data-item:last-child { border-bottom:none; }
button.delete { background:#d50000; color:#fff; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; transition:0.2s; }
button.delete:hover { transform:scale(1.05); }

button#clearAll { background:#ff6f00; color:#fff; padding:8px 16px; border:none; border-radius:8px; cursor:pointer; transition:0.2s; }
button#clearAll:hover { transform:scale(1.05); }
</style>
</head>
<body>

<header>
  <h1>LocalStorage Admin</h1>
  <button onclick="location.href='admin.html'">← Retour Admin</button>
</header>

<div class="container">
  <div class="card">
    <h2>Concerts</h2>
    <div id="concerts" class="data-section"></div>
  </div>

  <div class="card">
    <h2>Commentaires</h2>
    <div id="comments" class="data-section"></div>
  </div>

  <div class="card">
    <h2>Présences / Absences</h2>
    <div id="attendance" class="data-section"></div>
  </div>

  <button id="clearAll">Tout supprimer</button>
</div>

<script>
function loadData(){
  const concerts = JSON.parse(localStorage.getItem('concerts')||'[]');
  const comments = JSON.parse(localStorage.getItem('comments')||'{}');
  const attendance = JSON.parse(localStorage.getItem('attendance')||'{}');

  const concertsDiv = document.getElementById('concerts');
  concertsDiv.innerHTML='';
  concerts.forEach((c,i)=>{
    const div = document.createElement('div'); div.className='data-item';
    div.innerHTML=`<span>${i}: ${c.title} (${c.date} ${c.time||''})</span> <button class="delete" onclick="deleteConcert(${i})">Supprimer</button>`;
    concertsDiv.appendChild(div);
  });

  const commentsDiv = document.getElementById('comments');
  commentsDiv.innerHTML='';
  Object.keys(comments).forEach(idx=>{
    comments[idx].forEach((cm,j)=>{
      const div = document.createElement('div'); div.className='data-item';
      div.innerHTML=`<span>Concert ${idx} - ${cm.user}: ${cm.text}</span> <button class="delete" onclick="deleteComment(${idx},${j})">Supprimer</button>`;
      commentsDiv.appendChild(div);
    });
  });

  const attendanceDiv = document.getElementById('attendance');
  attendanceDiv.innerHTML='';
  Object.keys(attendance).forEach(idx=>{
    const div = document.createElement('div'); div.className='data-item';
    div.innerHTML=`<span>Concert ${idx} - Présents: ${attendance[idx].present||0}, Absents: ${attendance[idx].absent||0}</span>`;
    attendanceDiv.appendChild(div);
  });
}

function deleteConcert(i){
  if(!confirm('Supprimer ce concert ?')) return;
  const concerts = JSON.parse(localStorage.getItem('concerts')||'[]');
  concerts.splice(i,1);
  localStorage.setItem('concerts',JSON.stringify(concerts));

  // Supprimer commentaires et présence associés
  const comments = JSON.parse(localStorage.getItem('comments')||'{}');
  const attendance = JSON.parse(localStorage.getItem('attendance')||'{}');
  delete comments[i];
  delete attendance[i];
  localStorage.setItem('comments',JSON.stringify(comments));
  localStorage.setItem('attendance',JSON.stringify(attendance));

  loadData();
}

function deleteComment(idx,j){
  const comments = JSON.parse(localStorage.getItem('comments')||'{}');
  if(comments[idx]){
    comments[idx].splice(j,1);
    localStorage.setItem('comments',JSON.stringify(comments));
  }
  loadData();
}

document.getElementById('clearAll').addEventListener('click',()=>{
  if(confirm('Tout supprimer du localStorage ?')){
    localStorage.clear();
    loadData();
  }
});

loadData();
</script>

</body>
</html>

