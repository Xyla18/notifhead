<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#121212; color:#fff; }
header { display:flex; justify-content:space-between; align-items:center; padding:16px 24px; background:#000; box-shadow:0 4px 10px rgba(0,0,0,0.5);}
header h1 { margin:0; font-size:1.8rem; }
header button { background:#ff0000; padding:8px 16px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.2s; }
header button:hover { background:#cc0000; transform:scale(1.05); }
.container { display:flex; flex-wrap:wrap; gap:24px; margin:24px; }
.card { background:#1e1e1e; padding:16px; border-radius:12px; flex:1; min-width:320px; }
label { display:block; margin-top:12px; font-weight:bold; }
input,textarea { width:100%; padding:8px; margin-top:6px; border-radius:6px; border:none; }
input[type=file]{ padding:3px; }
.concert-item { border:1px solid #333; padding:12px; border-radius:8px; margin-bottom:12px; }
.concert-item img { max-width:100%; border-radius:6px; margin-top:6px; }
.actions{ display:flex; gap:8px; margin-top:8px; }
.actions button{ flex:1; padding:6px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
.actions button.delete{ background:#ff5555; color:#fff; }
.actions button.edit{ background:#00ccff; color:#000; }
</style>
</head>
<body>

<header>
  <h1>Mode Admin</h1>
  <button id="btnLogout">Déconnexion</button>
</header>

<div class="container">
<div class="card">
<h2>Concerts existants</h2>
<div id="concertList"></div>
</div>

<div class="card">
<h2>Ajouter / Modifier un concert</h2>
<form id="form">
<input type="hidden" id="idx">
<label>Titre<input id="title" required></label>
<label>Date<input type="date" id="date"></label>
<label>Heure<input type="time" id="time"></label>
<label>Lieu<input type="text" id="lieu" placeholder="Commencez à taper une adresse" required></label>
<label>Image<input type="file" id="image" accept="image/*"></label>
<label>Description<textarea id="desc" rows="4"></textarea></label>
<div class="actions">
<button type="submit">Enregistrer</button>
<button type="button" id="btnReset">Annuler</button>
</div>
</form>
</div>
</div>

<!-- Geoapify Autosuggest -->
<script src="https://unpkg.com/@geoapify/geocoder-autocomplete@1.4.1/dist/index.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@geoapify/geocoder-autocomplete@1.4.1/dist/geocoder-autocomplete.min.css">

<script>
if(sessionStorage.getItem('isAdmin')!=='1'){ alert('Accès non autorisé'); location.href='login.html'; }

document.getElementById('btnLogout').addEventListener('click',()=>{ sessionStorage.removeItem('isAdmin'); location.href='index.html'; });

function getConcerts(){ return JSON.parse(localStorage.getItem('concerts')||'[]'); }
function saveConcerts(arr){ localStorage.setItem('concerts',JSON.stringify(arr)); }

function loadList(){
  const list=getConcerts();
  const container=document.getElementById('concertList');
  container.innerHTML='';
  if(list.length===0){ container.innerHTML='<p>Aucun concert.</p>'; return; }
  list.forEach((c,i)=>{
    const div=document.createElement('div'); div.className='concert-item';
    div.innerHTML=`<strong>${c.title}</strong>
      <div>${c.date} ${c.time||''} — ${c.lieu||''}</div>
      ${c.image?`<img src="${c.image}">`:''}
      <p>${c.desc||''}</p>
      <div class="actions">
        <button class="edit" data-edit="${i}">Modifier</button>
        <button class="delete" data-del="${i}">Supprimer</button>
      </div>`;
    container.appendChild(div);
  });
  container.querySelectorAll('[data-edit]').forEach(b=>b.addEventListener('click',e=>editItem(Number(e.currentTarget.dataset.edit))));
  container.querySelectorAll('[data-del]').forEach(b=>b.addEventListener('click',e=>{ if(confirm('Supprimer ce concert ?')) deleteItem(Number(e.currentTarget.dataset.del)); }));
}

function editItem(i){
  const c=getConcerts()[i];
  document.getElementById('idx').value=i;
  document.getElementById('title').value=c.title||'';
  document.getElementById('date').value=c.date||'';
  document.getElementById('time').value=c.time||'';
  document.getElementById('lieu').value=c.lieu||'';
  document.getElementById('desc').value=c.desc||'';
}

function deleteItem(i){ const list=getConcerts(); list.splice(i,1); saveConcerts(list); loadList(); }

document.getElementById('form').addEventListener('submit', async e=>{
  e.preventDefault();
  const idx=document.getElementById('idx').value;
  const file=document.getElementById('image').files[0];
  let imageData='';
  if(file){
    imageData=await new Promise(res=>{ const reader=new FileReader(); reader.onload=e=>res(e.target.result); reader.readAsDataURL(file); });
  } else if(idx){ imageData=getConcerts()[Number(idx)].image||''; }
  const concertData={
    title: document.getElementById('title').value.trim(),
    date: document.getElementById('date').value,
    time: document.getElementById('time').value,
    lieu: document.getElementById('lieu').value.trim(),
    image: imageData,
    desc: document.getElementById('desc').value.trim()
  };
  const concerts=getConcerts();
  if(idx) concerts[Number(idx)]=concertData;
  else concerts.push(concertData);
  saveConcerts(concerts); loadList(); document.getElementById('form').reset(); document.getElementById('idx').value='';
});

// Reset
document.getElementById('btnReset').addEventListener('click',()=>{ document.getElementById('form').reset(); document.getElementById('idx').value=''; });

// --- Geoapify Autocomplete ---
const geoInput = document.getElementById('lieu');
const autoComplete = new Geoapify.Autocomplete(geoInput, {
  apiKey: "VOTRE_CLE_API_GEOAPIFY",
  placeSelect: true,
  language: "fr",
  countries: ["fr"], 
});

autoComplete.on('select', function(event){
  geoInput.value = event.result.formatted; // Remplit le champ avec l'adresse complète
});

loadList();
</script>
</body>
</html>
