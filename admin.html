<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Concerts</title>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#121212; color:#fff; }
header { display:flex; justify-content:space-between; align-items:center; padding:16px 24px; background:#000; box-shadow:0 4px 10px rgba(0,0,0,0.5);}
header h1 { margin:0; font-size:1.8rem; }
header button { background:#ff0000; padding:8px 16px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
.container { display:flex; flex-wrap:wrap; gap:24px; margin:24px; }
.card { background:#1e1e1e; padding:16px; border-radius:12px; flex:1; min-width:320px; }
input,textarea { width:100%; padding:8px; margin-top:6px; border-radius:6px; border:none; }
.actions{ display:flex; gap:8px; margin-top:8px; }
.actions button{ flex:1; padding:6px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
.actions button.delete{ background:#ff5555; color:#fff; }
.actions button.edit{ background:#00ccff; color:#000; }
.concert-item { border:1px solid #333; padding:12px; border-radius:8px; margin-bottom:12px; }
</style>
</head>
<body>
<header>
  <h1>Mode Admin</h1>
  <button id="btnLogout">Déconnexion</button>
</header>

<div class="container">
  <div class="card">
    <h2>Concerts existants</h2>
    <div id="concertList">Chargement...</div>
  </div>

  <div class="card">
    <h2>Ajouter / Modifier un concert</h2>
    <form id="form">
      <input type="hidden" id="idx">
      <label>Titre<input id="title" required></label>
      <label>Date<input type="date" id="date"></label>
      <label>Heure<input type="time" id="time"></label>
      <label>Lieu<input id="lieu"></label>
      <label>Description<textarea id="desc" rows="4"></textarea></label>
      <div class="actions">
        <button type="submit">Enregistrer</button>
        <button type="button" id="btnReset">Annuler</button>
      </div>
    </form>
  </div>
</div>

<script type="module">
// ===== Firebase =====
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TON_API_KEY",
  authDomain: "TON_PROJET.firebaseapp.com",
  projectId: "TON_PROJET",
  storageBucket: "TON_PROJET.appspot.com",
  messagingSenderId: "XXX",
  appId: "XXX"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const colRef = collection(db, "concerts");

// ===== Logout fictif =====
document.getElementById('btnLogout').addEventListener('click',()=>{ 
  sessionStorage.removeItem('isAdmin'); 
  location.href='index.html'; 
});

// ===== Liste en temps réel =====
const concertList = document.getElementById('concertList');
onSnapshot(colRef, snapshot=>{
  concertList.innerHTML = '';
  snapshot.forEach(docSnap=>{
    const c = docSnap.data();
    const div = document.createElement('div');
    div.className = 'concert-item';
    div.innerHTML = `
      <strong>${c.title}</strong><br>
      ${c.date || ''} ${c.time || ''} — ${c.lieu || ''}<br>
      <p>${c.desc || ''}</p>
      <div class="actions">
        <button class="edit">Modifier</button>
        <button class="delete">Supprimer</button>
      </div>
    `;
    // Edit
    div.querySelector('.edit').addEventListener('click',()=>{
      document.getElementById('idx').value = docSnap.id;
      document.getElementById('title').value = c.title;
      document.getElementById('date').value = c.date || '';
      document.getElementById('time').value = c.time || '';
      document.getElementById('lieu').value = c.lieu || '';
      document.getElementById('desc').value = c.desc || '';
    });
    // Delete
    div.querySelector('.delete').addEventListener('click',async()=>{
      if(confirm("Supprimer ce concert ?")){
        await deleteDoc(doc(db,"concerts",docSnap.id));
      }
    });
    concertList.appendChild(div);
  });
});

// ===== Ajout / Modif =====
document.getElementById('form').addEventListener('submit', async e=>{
  e.preventDefault();
  const data = {
    title: document.getElementById('title').value.trim(),
    date: document.getElementById('date').value,
    time: document.getElementById('time').value,
    lieu: document.getElementById('lieu').value.trim(),
    desc: document.getElementById('desc').value.trim()
  };
  const id = document.getElementById('idx').value;
  if(id){
    await updateDoc(doc(db,"concerts",id), data);
  } else {
    await addDoc(colRef, data);
  }
  e.target.reset();
  document.getElementById('idx').value = '';
});

// ===== Reset =====
document.getElementById('btnReset').addEventListener('click',()=>{
  document.getElementById('form').reset();
  document.getElementById('idx').value='';
});
</script>
</body>
</html>
