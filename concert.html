<label>Date et Heure</label>
<div style="display:flex; gap:8px; align-items:center;">
  <input type="date" id="date">
  <input type="time" id="time">
  <button type="button" id="addToCalendar" style="padding:6px 12px; border:none; border-radius:6px; background:#00ccff; color:#000; cursor:pointer;">üìÖ Ajouter au calendrier</button>
</div>

<script>
document.getElementById('addToCalendar').addEventListener('click', () => {
  const title = encodeURIComponent(document.getElementById('title').value || 'Nouvel √âv√©nement');
  const lieu = encodeURIComponent(document.getElementById('lieu').value || '');
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;

  if (!date) { alert('Veuillez s√©lectionner une date.'); return; }

  // Format ISO pour Google Calendar : YYYYMMDDTHHMMSSZ
  let startDateTime = date.replace(/-/g,'');
  let endDateTime = date.replace(/-/g,'');

  if (time) {
    const t = time.split(':');
    startDateTime += 'T' + t[0].padStart(2,'0') + t[1].padStart(2,'0') + '00Z';
    let hour = parseInt(t[0])+1;
    hour = hour.toString().padStart(2,'0');
    endDateTime += 'T' + hour + t[1].padStart(2,'0') + '00Z';
  } else {
    startDateTime += 'T090000Z';
    endDateTime += 'T100000Z';
  }

  // 1Ô∏è‚É£ Google Calendar
  const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startDateTime}/${endDateTime}&location=${lieu}`;
  
  // 2Ô∏è‚É£ iPhone / Outlook / Apple Calendar : g√©n√©rer un fichier ICS
  const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${decodeURIComponent(title)}
DTSTART:${startDateTime.replace(/Z$/,'')}
DTEND:${endDateTime.replace(/Z$/,'')}
LOCATION:${decodeURIComponent(lieu)}
END:VEVENT
END:VCALENDAR`;

  const blob = new Blob([icsContent], { type: 'text/calendar' });
  const url = URL.createObjectURL(blob);

  // Demander √† l'utilisateur ce qu'il veut faire
  if (confirm('Ouvrir dans Google Calendar ? OK = Google, Annuler = Apple/Outlook')) {
    window.open(googleUrl, '_blank');
  } else {
    const a = document.createElement('a');
    a.href = url;
    a.download = 'evenement.ics';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
});
</script>
