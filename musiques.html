<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Musiques â€” BibliothÃ¨que</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdVemkxmbUdYG4scag95yh5PWSszTcJpc",
  authDomain: "notifhead.firebaseapp.com",
  projectId: "notifhead",
  storageBucket: "notifhead.appspot.com",
  messagingSenderId: "190210184035",
  appId: "1:190210184035:web:fdc67599bfc79f2bf1f956",
  measurementId: "G-HWW5Z08H60"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("tracksContainer");

  const q = query(collection(db, "musiques"), orderBy("createdAt","desc"));
  onSnapshot(q, (snap) => {
    container.innerHTML = "";
    snap.docs.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "track";

      const title = document.createElement("h3");
      title.textContent = data.titre;
      title.className = "title";
      title.onclick = () => {
        const queryStr = encodeURIComponent(data.titre + " " + data.artiste);
        const links = [
          {name:"Deezer", url:`https://www.deezer.com/search/${queryStr}`},
          {name:"Spotify", url:`https://open.spotify.com/search/${queryStr}`},
          {name:"Apple Music", url:`https://music.apple.com/us/search?term=${queryStr}`},
          {name:"Shazam", url:`https://www.shazam.com/track-search?query=${queryStr}`}
        ];
        // Ouvre le menu Deezer par dÃ©faut
        window.open(links[0].url,"_blank");
      };

      const artist = document.createElement("div");
      artist.textContent = data.artiste;
      artist.className = "artist";

      const audio = document.createElement("audio");
      audio.controls = true;
      audio.src = data.url;

      div.appendChild(title);
      div.appendChild(artist);
      div.appendChild(audio);
      container.appendChild(div);
    });
  });
});
</script>

<style>
body{margin:0;font-family:Inter,sans-serif;background:linear-gradient(180deg,#071026,#040619);color:white;display:flex;flex-direction:column;align-items:center;padding:20px}
h1{text-align:center;color:#ff007a;margin-bottom:20px}
.track{background:#1e1e2f;padding:12px;border-radius:14px;margin-bottom:10px;width:100%;max-width:500px}
.title{cursor:pointer;font-size:16px;color:#ff77aa;margin:0}
.artist{color:#9aa4b2;font-size:13px;margin:4px 0}
audio{width:100%;margin-top:6px}
.btns{display:flex;gap:10px;margin-bottom:20px}
button{padding:8px 12px;border:none;border-radius:10px;background:#7c3aed;color:white;cursor:pointer}
button:hover{background:#9c5ff0}
</style>
</head>
<body>
<h1>ðŸŽµ BibliothÃ¨que de Musiques</h1>
<div class="btns">
  <button onclick="location.href='index.html'">Accueil</button>
  <button onclick="location.href='login2.html'">Connexion Admin</button>
</div>
<div id="tracksContainer"></div>
</body>
</html>
