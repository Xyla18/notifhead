<header>
  <button id="btnHome">Accueil</button>
  <h1>Bibliothèque Musiques</h1>
  <button id="btnLogin">Admin</button>
</header>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabaseUrl = "https://hcjgggdnfznoitebphvs.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjamdnZ2RuZnpub2l0ZWJwaHZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjA1MDEsImV4cCI6MjA3NjA5NjUwMX0.evgN1B1dp8H0007N4qskRxXiAICJPajBAbgYFsPyX3s";

const supabase = createClient(supabaseUrl,supabaseKey);

document.getElementById("btnHome").onclick = ()=>window.location.href="index.html";

// ✅ Changement ici : redirige vers login2.html
document.getElementById("btnLogin").onclick = ()=>window.location.href="login2.html";

async function loadMusics(){
  const { data, error } = await supabase.from('musics').select('*').order('id',{ascending:true});
  const list = document.getElementById("musicList");
  if(error){ list.innerHTML="Erreur: "+error.message; return; }
  list.innerHTML="";
  data.forEach(m=>{
    const div = document.createElement("div"); div.className="music-card";

    const titleLink = document.createElement("div"); titleLink.className="music-title"; 
    titleLink.innerText = m.title + " - " + (m.artist||"");
    titleLink.onclick = ()=>{
      const site = prompt("Sur quel site rechercher ? (spotify/deezer/apple/shazam)").toLowerCase();
      let url="";
      const query = encodeURIComponent(m.title + " " + (m.artist||""));
      if(site==="spotify") url=`https://open.spotify.com/search/${query}`;
      else if(site==="deezer") url=`https://www.deezer.com/search/${query}`;
      else if(site==="apple") url=`https://music.apple.com/search?term=${query}`;
      else if(site==="shazam") url=`https://www.shazam.com/fr/search?q=${query}`;
      if(url) window.open(url,"_blank");
      else alert("Site non reconnu");
    };
    div.appendChild(titleLink);

    const audio = document.createElement("audio"); audio.controls=true; audio.src=m.audio_url;
    div.appendChild(audio);

    list.appendChild(div);
  });
}

loadMusics();
</script>
